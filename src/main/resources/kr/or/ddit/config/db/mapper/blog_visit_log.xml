<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="blog_visit_log">

	<!-- 방문 기록 추가 -->
	<insert id="insert_visit_log" parameterType="blog_visit_logVo">
	
		<!-- 방문기록이 있으면 날짜만 업데이트 -->
		<!-- 방문기록이 없으면 새로 등록 -->
		merge into visit_log
			using dual
			on(visitor_id = #{ visitor_id })
			when matched then
			    update set visit_date = sysdate
			    where visitor_id = #{ visitor_id }
			when not matched then 
			    insert(VISIT_CODE, USER_ID, VISITOR_ID, VISIT_DATE)
			    values(visit_code_seq.nextval, #{user_id}, #{ visitor_id }, sysdate)
	</insert>
	
	

</mapper> 