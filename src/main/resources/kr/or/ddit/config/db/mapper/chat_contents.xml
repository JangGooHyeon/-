<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="chat_contents">
	
	<!-- 채팅 내용 등록  -->
	<insert id="insert_chatcontets" parameterType="chat_contentsVo">
		insert into chat_contents
             values(content_code_seq.nextval,#{chat_code,jdbcType=VARCHAR},#{mem_id},#{chat_content},'N',sysdate)
	</insert>
	
	<!-- 선택한 채팅방 조회  -->
	<select id="select_chatContents" parameterType="String" resultType="chat_contentsVo">
		select b.content_code,
		       b.chat_code, 
		       b.mem_id, 
		       b.chat_content, 
		       b.read_status, 
		       b.write_date, 
		       c.chat_name, 
		       d.memCount,
		       a.name
		  from chat_contents b, (select chat_code, chat_name
		                                    from chatroom) c, (select count(mem_id) as memCount, chat_code
		                                                        from chat_member
		                                                       group by chat_code ) d,(select a.mem_id,
		                                                                                    case when a.mem_id = b.user_id then b.user_name
		                                                                                         else c.corp_name end as name
		                                                                               from member a, users b, CORPORATION c
		                                                                              where a.mem_id = b.user_id(+)
		                                                                                and c.corp_id(+) = a.mem_id) a
		 where c.chat_code = b.chat_code
		   and d.CHAT_CODE = b.chat_code
		   and a.mem_id = b.mem_id
		   and b.chat_code = #{chat_code,jdbcType=VARCHAR}
		 order by b.write_date asc , b.content_code asc
	</select>
</mapper> 